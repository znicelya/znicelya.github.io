{"title":"Zookeeper数据结构","uid":"05e68499718743acc72aacd2dcdacd5c","slug":"zookeeper/Zookeeper数据结构","date":"2022-02-14T04:41:21.000Z","updated":"2022-02-16T07:20:32.592Z","comments":true,"path":"api/articles/zookeeper/Zookeeper数据结构.json","keywords":null,"cover":"https://gitee.com/zniceya/picgo/raw/master/image/20220215143300.jpeg","content":"<h3 id=\"Zookeeper数据结构\"><a href=\"#Zookeeper数据结构\" class=\"headerlink\" title=\"Zookeeper数据结构\"></a>Zookeeper数据结构</h3><h4 id=\"2-1-名称空间\"><a href=\"#2-1-名称空间\" class=\"headerlink\" title=\"2.1 名称空间\"></a>2.1 名称空间</h4><p>zookkeeper 提供的名称空间非常类似于标准文件系统，key-value 的形式存储。名称 key 由斜线 <strong>/</strong> 分割的一系列路径元素，zookeeper 名称空间中的每个节点都是由一个路径标识。</p>\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/20220215143300.jpeg\" alt=\"img\"></p>\n<h4 id=\"2-2-Zookeeper如何存储数据\"><a href=\"#2-2-Zookeeper如何存储数据\" class=\"headerlink\" title=\"2.2 Zookeeper如何存储数据\"></a>2.2 Zookeeper如何存储数据</h4><p>输入help查看zookeeper的帮助文档</p>\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/image-20220215225717632.png\" alt=\"image-20220215225717632\"></p>\n<ul>\n<li><p>创建节点</p>\n<pre class=\"line-numbers language-bash\\\" data-language=\"bash\\\"><code class=\"language-bash\\\">create [znode]</code></pre></li>\n<li><p>创建节点并保存数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create [znode] [data]</code></pre>\n\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/image-20220215230012532.png\" alt=\"image-20220215230012532\"></p>\n</li>\n<li><p>查看数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">get [node]</code></pre>\n\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/image-20220215230113885.png\" alt=\"image-20220215230113885\"></p>\n</li>\n</ul>\n<h4 id=\"2-3-Zookeeper中的zndoe是什么样的数据结构\"><a href=\"#2-3-Zookeeper中的zndoe是什么样的数据结构\" class=\"headerlink\" title=\"2.3 Zookeeper中的zndoe是什么样的数据结构\"></a>2.3 Zookeeper中的zndoe是什么样的数据结构</h4><p>zk中的znode中包含了四种数据</p>\n<ul>\n<li><p>data</p>\n<p>保存数据</p>\n</li>\n<li><p>acl</p>\n<p>权限：定义了什么样的用户能操作这个节点且能进行怎样的操作</p>\n<ul>\n<li>c : create 创建权限，允许在该节点下创建子节点</li>\n<li>w: write 更新权限，允许更新该节点下的数据</li>\n<li>r: read 读取权限，允许读取该节点及该节点下的子节点的列表信息</li>\n<li>d: delete 删除权限,允许删除该节点的子节点</li>\n<li>a: admin 管理员权限,允许对该节点进行acl权限设置</li>\n</ul>\n</li>\n<li><p>stat</p>\n<p>描述该节点的元数据</p>\n</li>\n<li><p>child</p>\n<p>当前节点的子节点</p>\n</li>\n</ul>\n<h4 id=\"2-4-ZK中节点的znode的类型\"><a href=\"#2-4-ZK中节点的znode的类型\" class=\"headerlink\" title=\"2.4 ZK中节点的znode的类型\"></a>2.4 ZK中节点的znode的类型</h4><ul>\n<li><p>持久节点：创建的节点在会话结束后依然存在。保存数据</p>\n<p>创建持久节点</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create [node]</code></pre></li>\n<li><p>持久序号节点：创建出的节点，会根据先后顺序，在节点后跟上一个数值，越后执行数值越大，适用于分布式锁的应用场景-单调递增</p>\n<p>创建持久序号节点</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create -s [node]</code></pre></li>\n<li><p>临时节点：</p>\n<p>创建临时节点</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create -e [node]</code></pre>\n\n<p>临时节点是在会话结束后，自动被删除的(10s左右)，通过这个特性，zk可以实现服务注册与发现的效果，那么临时节点是如何维持心跳呢？</p>\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/image-20220215232451993.png\" alt=\"image-20220215232451993\"></p>\n</li>\n<li><p>临时序号节点 : 跟持久序号节点相同，适用于临时的分布式锁</p>\n<p>创建临时序号节点</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create -s -e [node]</code></pre></li>\n<li><p>Container节点(3.5.3版本新增): Container容器节点，当容器中没有任何节点，该容器节点会被zk定时删除(60s)</p>\n</li>\n<li><p>TTL(Time To Life)节点：可以指定节点到期时间，到期后被zk定时删除</p>\n<p><code>通过系统配置zookeeper.extendedTypesEnable=true开启</code></p>\n</li>\n</ul>\n<h4 id=\"2-5-Zk的数据持久化\"><a href=\"#2-5-Zk的数据持久化\" class=\"headerlink\" title=\"2.5 Zk的数据持久化\"></a>2.5 Zk的数据持久化</h4><p>zk的数据是运行在内存中的，zk提供了两种持久化机制</p>\n<ul>\n<li><p>事务日志</p>\n<p>zk把执行的命令以日志的形式保存在dataLogDir指定的文件夹中（如果没有dataLogDir则放入dataDir中）</p>\n</li>\n<li><p>数据快照</p>\n<p>zk会在一定的时间间隔之内做一次内存数据的快照，把该时刻的内存中的数据保存在快照文件中</p>\n</li>\n</ul>\n<p>zk通过两种形式的持久化，在恢复时先恢复快照中的数据到内存中，再用日志文件中的数据进行增量恢复，这样恢复的速度更快</p>\n<h4 id=\"2-6-CAP理论\"><a href=\"#2-6-CAP理论\" class=\"headerlink\" title=\"2.6 CAP理论\"></a>2.6 CAP理论</h4><p>CAP 理论指出对于一个分布式计算系统来说，不可能同时满足以下三点：</p>\n<ul>\n<li><strong>一致性</strong>：在分布式环境中，一致性是指数据在多个副本之间是否能够保持一致的特性，等同于所有节点访问同一份最新的数据副本。在一致性的需求下，当一个系统在数据一致的状态下执行更新操作后，应该保证系统的数据仍然处于一致的状态。</li>\n<li><strong>可用性：</strong>每次请求都能获取到正确的响应，但是不保证获取的数据为最新数据。</li>\n<li><strong>分区容错性：</strong>分布式系统在遇到任何网络分区故障的时候，仍然需要能够保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障。</li>\n</ul>\n<p>一个分布式系统最多只能同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance）这三项中的两项。</p>\n<p>在这三个基本需求中，最多只能同时满足其中的两项，P 是必须的，因此只能在 CP 和 AP 中选择，zookeeper 保证的是 CP，对比 spring cloud 系统中的注册中心 eruka 实现的是 AP。</p>\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/20220215143617.png\" alt=\"img\"></p>\n<h4 id=\"2-7-BASE-理论\"><a href=\"#2-7-BASE-理论\" class=\"headerlink\" title=\"2.7 BASE 理论\"></a>2.7 BASE 理论</h4><p>BASE 是 Basically Available(基本可用)、Soft-state(软状态) 和 Eventually Consistent(最终一致性) 三个短语的缩写。</p>\n<ul>\n<li><strong>基本可用：</strong>在分布式系统出现故障，允许损失部分可用性（服务降级、页面降级）。</li>\n<li><strong>软状态：</strong>允许分布式系统出现中间状态。而且中间状态不影响系统的可用性。这里的中间状态是指不同的 data replication（数据备份节点）之间的数据更新可以出现延时的最终一致性。</li>\n<li><strong>最终一致性：</strong>data replications 经过一段时间达到一致性。</li>\n</ul>\n<p>BASE 理论是对 CAP 中的一致性和可用性进行一个权衡的结果，理论的核心思想就是：我们无法做到强一致，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性。</p>\n","text":"Zookeeper数据结构2.1 名称空间zookkeeper 提供的名称空间非常类似于标准文件系统，key-value 的形式存储。名称 key 由斜线 / 分割的一系列路径元素，zookeeper 名称空间中的每个节点都是由一个路径标识。 2.2 Zookeeper如何存储数...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"zookeeper","slug":"zookeeper","count":5,"path":"api/categories/zookeeper.json"}],"tags":[{"name":"zookeeper","slug":"zookeeper","count":5,"path":"api/tags/zookeeper.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Zookeeper%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">Zookeeper数据结构</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-1-%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">2.1 名称空间</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-2-Zookeeper%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">2.2 Zookeeper如何存储数据</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-3-Zookeeper%E4%B8%AD%E7%9A%84zndoe%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\"><span class=\"toc-text\">2.3 Zookeeper中的zndoe是什么样的数据结构</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-4-ZK%E4%B8%AD%E8%8A%82%E7%82%B9%E7%9A%84znode%E7%9A%84%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">2.4 ZK中节点的znode的类型</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-5-Zk%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96\"><span class=\"toc-text\">2.5 Zk的数据持久化</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-6-CAP%E7%90%86%E8%AE%BA\"><span class=\"toc-text\">2.6 CAP理论</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#2-7-BASE-%E7%90%86%E8%AE%BA\"><span class=\"toc-text\">2.7 BASE 理论</span></a></li></ol></li></ol>","author":{"name":"znicelya","slug":"znicelya","avatar":"https://gitee.com/zniceya/picgo/raw/master/image/20220211200943.jpeg","link":"/","description":"hexo,nicely,blog,aurora","socials":{"github":"https://github.com/znicelya","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"https://gitee.com/zniceya/picgo/raw/master/image/u=839977396,1548112407&fm=253&fmt=auto&app=138&f=JPEG","link":"https://space.bilibili.com/177279267"}}}},"mapped":true,"prev_post":{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"Dubbo入门","date":"2022-02-14T13:05:44.271Z","updated":"2022-02-14T13:06:01.507Z","comments":true,"path":"api/articles/Dubbo入门.json","keywords":null,"cover":[],"text":"Dubbo入门1.背景-网站应用的演进随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。 单一应用架构当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"znicelya","slug":"znicelya","avatar":"https://gitee.com/zniceya/picgo/raw/master/image/20220211200943.jpeg","link":"/","description":"hexo,nicely,blog,aurora","socials":{"github":"https://github.com/znicelya","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"https://gitee.com/zniceya/picgo/raw/master/image/u=839977396,1548112407&fm=253&fmt=auto&app=138&f=JPEG","link":"https://space.bilibili.com/177279267"}}}}},"next_post":{"title":"Zookeeper概述","uid":"07093428334d4e05f766e4aacfd1b9ce","slug":"zookeeper/Zookeeper概述","date":"2022-02-14T04:40:21.000Z","updated":"2022-02-16T07:20:32.592Z","comments":true,"path":"api/articles/zookeeper/Zookeeper概述.json","keywords":null,"cover":"https://gitee.com/zniceya/picgo/raw/master/image/20220209131628.png","text":"1. Zookeeper概述1.1 Zookeeper背景 随着互联网技术的发展，企业对计算机系统的计算，存储能力要求越来越高，各大IT企业都在追求高并发，海量存储的极致，在这样的背景下，单纯依靠少量高性能单机来完成计算机，云计算的任务已经无法满足需求，企业的IT架构逐渐由集中式...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"zookeeper","slug":"zookeeper","count":5,"path":"api/categories/zookeeper.json"}],"tags":[{"name":"zookeeper","slug":"zookeeper","count":5,"path":"api/tags/zookeeper.json"}],"author":{"name":"znicelya","slug":"znicelya","avatar":"https://gitee.com/zniceya/picgo/raw/master/image/20220211200943.jpeg","link":"/","description":"hexo,nicely,blog,aurora","socials":{"github":"https://github.com/znicelya","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"https://gitee.com/zniceya/picgo/raw/master/image/u=839977396,1548112407&fm=253&fmt=auto&app=138&f=JPEG","link":"https://space.bilibili.com/177279267"}}}}}}