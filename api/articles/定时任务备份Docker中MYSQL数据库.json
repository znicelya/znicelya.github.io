{"title":"定时任务备份Docker中的MySQL数据库","uid":"236ba5ae8006493ed116e0eed1caa2a1","slug":"定时任务备份Docker中MYSQL数据库","date":"2022-02-11T09:22:11.000Z","updated":"2022-02-12T06:44:36.593Z","comments":true,"path":"api/articles/定时任务备份Docker中MYSQL数据库.json","keywords":null,"cover":"https://imgapi.cn/api.php?zd=zsy&fl=fengjing&gs=images","content":"<h1 id=\"定时任务备份Docker中的MySQL\"><a href=\"#定时任务备份Docker中的MySQL\" class=\"headerlink\" title=\"定时任务备份Docker中的MySQL\"></a>定时任务备份Docker中的MySQL</h1><h2 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>首先写一个备份docker中mysql的shell脚本</p></blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">#!&#x2F;bin&#x2F;bash\n# 备份路径\nBACKUP&#x3D;&#x2F;data&#x2F;backup&#x2F;db\n# 当前时间作为文件名\nDATETIME&#x3D;$(date +%Y%m%d_%H%M%S)\necho &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;开始备份&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;\necho &quot;备份路径是$BACKUP&#x2F;$DATETIME.tar.gz&quot;\n\n# 主机\nHOST&#x3D;loalhost\n#用户名\nDB_USER&#x3D;root\n#密码\nDB_PASS&#x3D;000000\n#数据库名\nDATABASE&#x3D;my_blog_db\n\nmkdir -p $BACKUP&#x2F;\n\ncd $BACKUP&#x2F;\n\necho &quot;start backup database sql files to localhost&quot;\n\t\t#mysql为镜像服务名\ndocker exec mysql mysqldump  -u$DB_USER -p$DB_PASS --databases $DATABASE &gt; $BACKUP&#x2F;$DATETIME.sql\n\ncd $BACKUP&#x2F;\n\ntar czf $DATETIME.tar.gz $DATETIME.sql\n\nrm -rf $DATETIME.sql\n\necho &quot;backup database sql files to localhost successfully&quot;</code></pre>\n<p>然后</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">chmod +x mysql-backup.sh</code></pre>\n<p>为其加上执行权限</p>\n<p><strong>我这里脚本文件名称为 mysql-backup.sh</strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>测试</p></blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">sh .&#x2F;mysql-backup.sh</code></pre>\n<p>执行完毕之后发现目录下多了一个以日期为命名的压缩包<br><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/1638411404352.png\"></p>\n<p>解压查看无误</p>\n<h2 id=\"定时\"><a href=\"#定时\" class=\"headerlink\" title=\"定时\"></a>定时</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>cron</p></blockquote>\n<p>首先确认cron是否开启</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl status cron</code></pre>\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/1638411548994.png\"></p>\n<p><strong>如图所示为开启状态</strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>crontab</p></blockquote>\n<p>crontab参数的使用</p>\n<ul>\n<li>crontab -u：指定用户进行操作，如crontab -u lile -e 那么编辑的就是lile用户的crontab文件</li>\n<li>crontab -l：输出当前crontab添加的定时任务</li>\n<li>crontab -r：<code>删除定时任务</code>（<code>慎用</code>，或者做备份，删除就没了，存放的文件位置为/var/spool/cron目录下，以所属者命名）</li>\n<li>crontab -e：编辑，添加定时任务</li>\n<li>crontab -i：与-r参数一起使用，crontab -ri 的话会询问是否删除</li>\n</ul>\n<p>我们使用crontab来添加一条定时任务</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">crontab -e</code></pre>\n<p>这时候会让我们选择以哪种方式编辑 选最熟悉的就好<br>我这里选了<code>Vim</code></p>\n<p><img src=\"https://gitee.com/zniceya/picgo/raw/master/image/1638411977890.png\"></p>\n<p><strong>这条命令前面的两个0 第一个代表分 ， 第二个代表时</strong></p>\n<p>至此mysql定时备份就完成了！</p>\n","feature":true,"text":"定时任务备份Docker中的MySQL备份 首先写一个备份docker中mysql的shell脚本 #!&#x2F;bin&#x2F;bash # 备份路径 BACKUP&#x3D;&#x2F;data&#x2F;backup&#x2F;db # 当前时间作为文件名 DATETI...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"Docker","slug":"Docker","count":3,"path":"api/categories/Docker.json"}],"tags":[{"name":"Docker","slug":"Docker","count":3,"path":"api/tags/Docker.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%A4%87%E4%BB%BDDocker%E4%B8%AD%E7%9A%84MySQL\"><span class=\"toc-text\">定时任务备份Docker中的MySQL</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%87%E4%BB%BD\"><span class=\"toc-text\">备份</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9A%E6%97%B6\"><span class=\"toc-text\">定时</span></a></li></ol></li></ol>","author":{"name":"znicelya","slug":"znicelya","avatar":"https://gitee.com/zniceya/picgo/raw/master/image/20220211200943.jpeg","link":"/","description":"hexo,nicely,blog,aurora","socials":{"github":"https://github.com/znicelya","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Bing-Dwen-Dwen","uid":"4b6f4220aabf9bab7576762495891640","slug":"Bing-Dwen-Dwen","date":"2022-02-12T06:27:46.000Z","updated":"2022-02-12T08:01:34.044Z","comments":true,"path":"api/articles/Bing-Dwen-Dwen.json","keywords":null,"cover":"https://gitee.com/zniceya/picgo/raw/master/image/20220212150339.png","text":" * { margin: 0; padding: 0 } body { font: 15px \"Microsoft YaHei\", Arial, Helvetica, sans-serif; background: #d4ebf1; color: #000; } .m_body ...","link":"","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"冰墩墩","slug":"冰墩墩","count":1,"path":"api/tags/冰墩墩.json"}],"author":{"name":"znicelya","slug":"znicelya","avatar":"https://gitee.com/zniceya/picgo/raw/master/image/20220211200943.jpeg","link":"/","description":"hexo,nicely,blog,aurora","socials":{"github":"https://github.com/znicelya","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"word文档转换","uid":"df024b531a7b1e89b5efdfbabc076190","slug":"word文档转换","date":"2022-02-05T09:22:11.000Z","updated":"2022-02-12T06:44:36.593Z","comments":true,"path":"api/articles/word文档转换.json","keywords":null,"cover":"https://imgapi.cn/api.php?zd=zsy&fl=fengjing&gs=images","text":"word文档转换最近公司业务需求要把HTML和word文档互相转换，经过技术选型之后最终决定使用Apache POI（主要因为其他现有解决方案收费），记录一下 Maven &lt;dependency&gt; &lt;groupId&gt;org.htmlparser&lt;&#...","link":"","photos":[],"count_time":{"symbolsCount":"7.5k","symbolsTime":"7 mins."},"categories":[{"name":"poi","slug":"poi","count":1,"path":"api/categories/poi.json"}],"tags":[{"name":"poi","slug":"poi","count":1,"path":"api/tags/poi.json"}],"author":{"name":"znicelya","slug":"znicelya","avatar":"https://gitee.com/zniceya/picgo/raw/master/image/20220211200943.jpeg","link":"/","description":"hexo,nicely,blog,aurora","socials":{"github":"https://github.com/znicelya","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}